% This file makes use of sydetex.

% sydetex is free software: you can redistribute it and/or modify
% it under the terms of the GNU General Public License as published by
% the Free Software Foundation, either version 3 of the License, or
% any later version.

% sydetex is distributed in the hope that it will be useful,
% but WITHOUT ANY WARRANTY; without even the implied warranty of
% MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
% GNU General Public License for more details.

% You should have received a copy of the GNU General Public License
% along with sydetex.  If not, see <https://www.gnu.org/licenses/>.


\documentclass[12pt]{article}
\usepackage[utf8]{inputenc}
\usepackage{setspace}
\usepackage{CJK}



% THIS IS WHERE ALL THE SYDE STUFF IS
\usepackage{sydestyle}



% Reference tooling package settings - point to where the files are
\graphicspath{{figures/}}

\addbibresource{references.bib}

\makeglossaries
\input{glossary.tex}


% hyperref is a prissy princess, so we import it here to prevent weirdness with sydetex.sty
\usepackage{hyperref}
\hypersetup{
    bookmarks=false
}



% PERSONAL DETAILS HERE, this sets up title page
\def\reportTitle{Designing a Circuit Protection Sensor Module}
\def\reportDueDate{September 6, 2018}
\def\studentName{Si Teng Liu}
\def\studentNumber{20473965}
\def\company{FireBright Corporation}
\def\lastSemester{3A}



% Form fitting ;)
\title{\reportTitle}
\author{\studentName}
\studentnumber{\studentNumber}
\lastsemester{\lastSemester}
\date{\reportDueDate}
\employer{\company}
\employeraddress{
\begin{CJK}{UTF8}{gbsn}
松江区 莘砖公路 518号 16号楼, Shanghai, China
\end{CJK}
}



% ------------------------------START OF DOCUMENT------------------------------

% You shouldn't need to edit code above this line for the template to work as 
% intended. Just fill in your content and it should work Just Like Magic (TM).

\begin{document}

    
    \startindent
	\makewtrtitle
	\stopindent
	
	
	\begin{singlespace}
        \begin{flushright}
        James Si Teng Liu\\
    	251 Cochrane Terrace\\
	    Milton, ON, Canada, L9T 8C8\\
	    \end{flushright}


		% TODO: CHECK ME IF IT'S STILL FIEGUTH
		Dr. Paul Fieguth, Professor and Department Chair
	
		Systems Design Engineering
	
	    University of Waterloo
	
	    Waterloo, ON
	
	    N2L 3G1\\
	
		Dear Professor Fieguth,
	\end{singlespace}
    
        I have prepared this report, ``\reportTitle" as my 3B Work Report for the Engineering team at \company. This report is the final of three that I must submit as part of my degree requirements, and it has not received any previous academic credit. This report was entirely written by me and has not received any previous academic credit at this or any other institution.\\
    	
    	FireBright designs and manufactures battery charging solutions for electric vehicles. Under the guidance of my manager Chen Jie, I was able to succcessfully produce the electrical specifications and final design of a circuit protection board.\\
    	
    	The purpose of this report is to detail the process and design choices made in the creation of this circuit protection module, as well as major points of learning through the process. \\


	    \noindent
	    Sincerely,\\
	   % \includegraphics[scale =0.2]{signature}\\
    	
    	\studentName \\
    	\studentNumber \\
        3B Systems Design Engineering

	% new page at the end of the letter.
	\newpage


	% Abstract
	%\addcontentsline{toc}{section}{Abstract}
	\begin{abstract}
    Fire safety is a critical component of battery technology, on the road to to fulfill this requirement for a new line of products, FireBright has commissioned a new module to address fire safety from both prevention and protection perspectives. This report details with the design and prototyping process of this module. The problem space is familiar territory to the company, with known sensitivity levels to tune the sensors towards. New issues include the demand for a smaller physical size, lower cost, and more robust layout.
	    
    The solution relies mainly on a architectural shift from individual \acrfull{ocp} modules for sub-assemblies to a main \acrshort{ocp} module for a single product. A smaller footprint and more design robustness is borne from making more use of digital logic in place of hardware based detection. The trade-off being made is the speed of activation of the protective measures. Given that a short-circuit protection module is also being planned, this weakness can be shored up for mission-critical circuitry in sub-assemblies, while less critical circuits still enjoy the benefit of a 'centralised' protection system.
	    
    As a result of the design and prototyping.
	\end{abstract}


	% Make a table of contents.
	\phantomsection % this adds the correct hyperref link, if you add custom ToC sections (as per \addcontentsline) USE THIS EXACT ORDERING OF COMMANDS
	\addcontentsline{toc}{section}{Table of Contents}
	\tableofcontents

	% List of figures and tables.
	\phantomsection
	\addcontentsline{toc}{section}{List of Figures}
	\listoffigures
	
	
	\phantomsection
	\addcontentsline{toc}{section}{List of Tables}
	\listoftables
	
	
	\section{Introduction}
  \pagenumbering{arabic}  % Couldn't figure out how to automate this, but leave this line in to restart page numbers at 1 and with arabic numbers.
  FireBright works in battery technology - specifically lithium-based battery solutions. Their main product is a battery hot-swap system for electric vehicles. For which FireBright designs and produces charging stations, battery packs, and vehicle specific framing. 
	
	\subsection{Problem Space}
	Due to high energy density and the flammability of the pole materials, fire safety is a critical component of lithium battery operation. For the company's new line of products, there is a need for a smaller and more robust \acrfull{cpm} that can be fitted in many different assemblies. As an Engineering Student, designing this module, prototyping, and testing the completed design was the assigned task for my work term.
	
    \paragraph{}
	The work with realizing the architecture of the module while following good engineering practice - working out details, in essence.

  \paragraph{A Note on Terminology and Linguistics} - This project was done in an electrical engineering dominated environment, as such the terminology used tends toward abbreviated units and electrical shorthand. They will be expanded and explained whenever possible.
  
  \section{Design Space}
  As per the engineering design workflow in FireBright, a great deal of design choices have already been made by the design team for a physical prototype to be green-lit. The choices made include the objectives of the module (the main problem it addresses), an architectural outline of major required components, and a specific microcontroller choice.

  \paragraph{}
  As a first step, the design choices already made must be squared with the objectives. Some design choices are quite concrete, and this will eventually lead specifications developed around them. Other

  \subsection{Objectives}
  This module's main purpose is to act as a safety mechanism guarding against and reporting power circuitry failure - specifically over-current situations and fire. It must be able to detect and report any current flow over the set limit along with the presence of a battery fire.

  \paragraph{}
  Finally, the module must be able to integrate into the existing solution system and future systems developed by FireBright. This process is discussed in detail in section \ref{sec:integration}. 
  
  \paragraph{}
  To meet these objectives, an initial scope has already been set forth by the design team, with a number of design choices already made. Work done this term is built on top of the outlines previously developed.
	
	\subsection{Pre-Determined Scope\label{sec:pre-determined-scope}}
	At the start of the \acrfull{cpm} project, the determined scope consists of an architectural outline (including mandatory components) and two main requirement sets - electrical input/output, and board safety. Electrical I/O being both upper limits to the electrical signal strength (voltage and current) for individual inputs and outputs, and the expected signal profiles. Board safety would consist of absolute maximum ratings for materials, failure modes, and arc distances.
	
    \subsubsection{Architecture\label{sec:architecture}}
    The \acrshort{cpm} is a collection of sensors feeding into a microcontroller, which will communicate the sensor data through a standard transmission protocol used in FireBright's other products. As a system, the module will monitor the sensor data and break a relay switch that controls the main power circuit should sensor readings surpass programmed thresholds. The thresholds have been pre-determined, thus will not be gone into in detail. 

    \paragraph{}
    The sensors deemed as required on this module are: two temperature sensors, one smoke sensor, and an AC current sensor. Three components have been chosen ahead of time as required - EFM8BB1 \acrfull{soc} , MAX3485 RS-485 transceiver, and a specific current sensing transformer.

    \paragraph{Physical Response Systems}
    Sensory signals are also part of the requirement of the system, with controllable LED and buzzer components marked as required. 

    \subsection{Input and Output} 
    There are two main types of electrical communication between the various system components - signal and power. The power electric behaviour is outlined as a single power supply source, followed by power modulation units that filter and deliver steady power to the components. The specifics would be determined through the design process.

    \paragraph{}
    The signal behaviour were also delivered as a general outline of component intercommunication \footnote{i.e. - Must have communication from sensor to SoC, SoC to transceiver, and so on.}. The final signal profiles were reached through design, testing, and analysis.

    \paragraph{}
    Ultimately, input and output signal levels and limits are left as an excercise for the student to develop, with reference to the specified components - both explicitly named (SoC and Transceiver), and general (sensors needed, relay).

    \subsection{Power considerations}
    As the module is going to be a safety mechanism, it is intended to stay powered at all times, thus power draw is specifically budgeted at less than 1 watt on average.
	
    \subsection{Developing Specifications}
    Given the scope and requirements set out at the start of the project, a number of specifications can be extracted from the pre-determined components. These specifications come in the form of voltage levels, signal profiles, and other electrical details that actualize connections between the individual components.

    It turns out the operating range and behaviour of the SoC alone is sufficient to determine specifications of all sensor circuits. Furthermore, the SoC controlled devices must necessarily respond to the signals that the chip is capable of delivering - i.e. if the chip can only provide signals at 3.3V, a switch requiring 5V cannot be directly controlled by the SoC.

    \paragraph{}
    A quick connection diagram (Figure \ref{fig:connect-diag}) helped visualise the connections. The connections go from the components in the left column to the components in the top row. (1) denotes a 3.3V connection, (2) denotes a 5V connection, (*) denotes an analog (variable voltage level) connection. A later version is shown here which includes power routing that was not done at this step. From the diagram, it was evident that most electrical connectivity is (as expected) centered around the SoC. 
  
    \begin{figure}[]
      \centering
      \caption{Connection chart detailing the input and output relationships between the components.}
      \label{fig:connect-diag}
      \includegraphics{connection-chart}
    \end{figure}
	
    Given this result, designing the sensor circuitry around the specifications of the EFM8BB1 SoC would be a fairly direct way to accomplish the objectives of the system.

    \subsubsection{Other Options?}
    Given the inflexible nature of the SoC being pre-selected as a fixed part of the design, forcing the SoC to behave according to the sensor output may come at significant software cost. \footnote{A cost-benefit analysis (with due consideration for the architecture) was done by the design team previous to this design cycle to select the SoC as it was likely to be the most expensive component in the module.}

    \paragraph{}
    To further explain, a \acrlong{soc} is a collection of Application Specific Integrated Circuits \acrshort{asic} that provide additional functionality to a CPU. For the EFM8BB1 in particular, there is an \acrfull{adc} \acrshort{asic} in the chip itself that is pre-set for a certain voltage range, but with an option to use an external voltage reference. However this requires an external voltage reference: an additional complexity to implement as a hard circuit, versus simply using the SoC as-is requiring no additional board space.
  
    \paragraph{What if the SoC selection is bad?}

  
	
	
	
	\section{Developing Electrical Design\label{sec:devel-electr-design}} 

  \subsection{Integration\label{sec:integration}}

	\subsection{Power}
  

  - Relay uses raw input - set input to sane value
  - speaker power is switched by the SoC, power delivered by the LDO
	
	\section{Developing Mechanical Specifications}
	
	\section{Details and Datasheets}
  T
  From the datasheet of the EFM8BB1\cite{silabs:efm8bb1},

  The operating voltage level of the EFM8BB1 family is 3.3V, thus the sensor circuitry must conform to this level. There eventually arose a need for a separate 5V signal level due to the smoke sensor's digital circuit, resolving this will be touched upon in section \ref{sec:devel-electr-design}.

  \paragraph{}
  Ultimately for each sensor, the signal strength must be scaled to the acceptable input voltage ranges of the microcontroller, and the output must be able to be controlled by the voltage signal generated by the microcontroller as well.
	\section{Understanding Limitations}
	\subsection{Resources}
  \subsubsection{Accuracy of Measurement Tools}
	\subsection{Tooling Available}
	
	\section{Component Selection}
	
	\section{Final Electrical Design}
	
	
    \printglossaries
    
    \phantomsection
    \printbibliography[heading=bibintoc]
	

\end{document}


